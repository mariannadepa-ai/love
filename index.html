<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Walentynka üíò</title>

  <style>
    :root { --bg1:#ffdde1; --bg2:#ee9ca7; }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; display:grid; place-items:center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(circle at 20% 20%, #fff 0 20%, transparent 21%),
                  radial-gradient(circle at 80% 30%, #fff 0 14%, transparent 15%),
                  linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow:hidden;
    }

    .hidden{ display:none !important; }

    /* wrapper: tytu≈Ç + captcha (bez odstƒôpu) */
    .gateWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 0px;
      z-index: 2;
    }
    .top-title{
      width:min(560px, 92vw);
      text-align:center;
      font-weight:900;
      font-size:clamp(22px, 4.5vw, 34px);
      letter-spacing:.3px;
      margin: 0;
      padding: 0;
      line-height: 1.05;
      color:#111;
      text-shadow: 0 10px 30px rgba(0,0,0,.12);
    }

    /* ====== CAPTCHA ====== */
    .captcha{
      width: min(360px, 94vw);
      background:#fff;
      border:1px solid #d7d7d7;
      border-radius:10px;
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      overflow:hidden;
      font-family: Arial, system-ui, sans-serif;
      position:relative;
      z-index: 2;
      margin-top: 0;
    }
    .captcha-header{ background:#2f74ff; color:#fff; padding:12px 12px; text-align:left; }
    .captcha-title{ font-size:12px; opacity:.95; letter-spacing:.2px; }
    .captcha-subtitle{ font-size:18px; font-weight:700; margin-top:2px; line-height:1.1; }
    .captcha-body{ padding:10px; background:#f6f6f6; }
    .captcha-grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:2px;
      background:#cfcfcf;
      padding:2px;
      border-radius:6px;
    }
    .cap-tile{
      position:relative;
      background:#fff;
      aspect-ratio: 1 / 1;
      cursor:pointer;
      overflow:hidden;
      border-radius:4px;
      user-select:none;
    }
    .cap-tile img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      user-select:none;
      pointer-events:none;
    }
    .cap-tile.selected::after{
      content:"";
      position:absolute;
      inset:0;
      border:4px solid #2f74ff;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.7);
    }
    .cap-tile.selected::before{
      content:"‚úì";
      position:absolute;
      right:6px;
      top:6px;
      width:22px;
      height:22px;
      border-radius:999px;
      background:#2f74ff;
      color:#fff;
      display:grid;
      place-items:center;
      font-weight:800;
      font-size:14px;
      box-shadow: 0 6px 14px rgba(0,0,0,.18);
      z-index: 2;
    }
    .captcha-footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-top:1px solid #e6e6e6;
      background:#fff;
    }
    .captcha-status{ font-size:12px; color:#555; min-height:16px; }
    .captcha-actions{ display:flex; gap:8px; }
    .cap-btn{
      border:1px solid #d7d7d7;
      background:#fff;
      border-radius:6px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
    }
    .cap-btn.primary{ background:#2f74ff; color:#fff; border-color:#2f74ff; }
    .cap-btn.ghost{ width:38px; }

    /* ====== LABIRYNT ====== */
    .mazeWrap{
      width:min(560px, 92vw);
      background: rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.65);
      border-radius:24px;
      padding:18px 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      text-align:center;
      backdrop-filter: blur(10px);
      z-index:2;
    }
    .mazeTitle{
      font-weight:900;
      font-size:clamp(18px, 3.5vw, 22px);
      margin:0 0 4px;
    }
    .mazeSub{
      font-size:13px;
      opacity:.85;
      margin:0 0 12px;
    }
    #maze{
      width:min(360px, 90vw);
      height:auto;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.12);
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      background:#fff;
      display:block;
      margin: 0 auto;
    }
    .mazeBtns{
      display:flex;
      gap:10px;
      justify-content:center;
      margin-top:12px;
    }
    .mazeHint{
      font-size:12px;
      color:#555;
      min-height:16px;
      margin-top:8px;
    }

    /* ====== KARTA ====== */
    .card{
      width:min(560px, 92vw);
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.55);
      border-radius:24px;
      padding:28px 26px;
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      text-align:center;
      position:relative;
      z-index: 2;
    }
    h1{margin:0 0 8px; font-size:clamp(26px, 5vw, 38px);}
    p{margin:10px 0; font-size:clamp(16px, 2.6vw, 18px); line-height:1.5;}
    .btns{display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:18px;}
    button{
      border:0; padding:12px 16px; border-radius:14px; cursor:pointer;
      font-weight:600; font-size:16px;
      box-shadow: 0 10px 25px rgba(0,0,0,.12);
      transition: transform .08s ease;
    }
    button:active{transform: translateY(1px) scale(.99);}
    .yes{background:#ff3b6b; color:#fff;}
    .no{background:#ffffff; color:#111;}

    /* serduszka */
    .heart{
      position:absolute; left:var(--x); top:110%;
      font-size: var(--s);
      animation: floatUp var(--d) linear infinite;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
      opacity:.95;
      user-select:none;
      pointer-events:none;
      z-index: 1;
    }
    @keyframes floatUp{
      from{ transform: translateY(0) rotate(0deg); opacity:0;}
      10%{opacity:1;}
      to{ transform: translateY(-140vh) rotate(360deg); opacity:0;}
    }

    /* ====== ATAK MI≈ÅO≈öCI ====== */
    .attack{
      width:min(560px, 92vw);
      background: rgba(255,255,255,.9);
      border:1px solid rgba(255,255,255,.65);
      border-radius:24px;
      padding:22px 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.18);
      text-align:center;
      position:relative;
      z-index: 2;
      backdrop-filter: blur(10px);
    }
    .attack-title{
      font-size:clamp(28px, 6vw, 44px);
      font-weight:900;
      letter-spacing:.6px;
      margin:0 0 12px;
    }
  </style>
</head>

<body>

  <!-- 1 widok -->
  <div class="gateWrap" id="gateWrap">
    <div class="top-title">Potwierd≈∫, ≈ºe jeste≈õ moim mƒô≈ºem</div>

    <div class="captcha" id="gate" role="dialog" aria-label="Weryfikacja obrazkowa">
      <div class="captcha-header">
        <div class="captcha-title">Wybierz wszystkie obrazy z</div>
        <div class="captcha-subtitle">TwojƒÖ WalentynkƒÖ</div>
      </div>

      <div class="captcha-body">
        <div class="captcha-grid" id="grid"></div>
      </div>

      <div class="captcha-footer">
        <div class="captcha-status" id="hint"></div>

        <div class="captcha-actions">
          <button class="cap-btn ghost" id="resetBtn" title="Wyczy≈õƒá zaznaczenie">‚Üª</button>
          <button class="cap-btn primary" id="checkBtn">Sprawd≈∫</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 2 widok: LABIRYNT -->
  <div class="mazeWrap hidden" id="mazeGate" role="dialog" aria-label="Labirynt weryfikacyjny">
    <div class="mazeTitle">Etap 2: przejd≈∫ labiryntem do mnie üòÑ</div>
    <div class="mazeSub">Kliknij <b>Start</b>, potem dojed≈∫ myszkƒÖ do zdjƒôcia. Nie dotykaj ≈õcian.</div>

    <canvas id="maze" width="360" height="360"></canvas>

    <div class="mazeBtns">
      <button class="cap-btn ghost" id="mazeReset" title="Reset">‚Üª</button>
      <button class="cap-btn primary" id="mazeStart">Start</button>
    </div>
    <div class="mazeHint" id="mazeHint"></div>
  </div>

  <!-- 3 widok: pytanie -->
  <div class="card hidden" id="card">
    <h1>Misiu Pysiu<span id="name">, M√≥j Kr√≥lisiu</span> üíò</h1>
    <p style="font-size:20px; font-weight:700;">Zostaniesz mojƒÖ WalentynkƒÖ? (wybierz dobrze)</p>

    <div class="btns">
      <button class="yes" id="yesBtn">TAK ‚ù§Ô∏è</button>
      <button class="no" id="noBtn">Nie üôà</button>
    </div>
  </div>

  <!-- 4 widok: atak mi≈Ço≈õci -->
  <div class="attack hidden" id="loveAttack">
    <div class="attack-title">ATAK MI≈ÅO≈öCI!!!</div>

    <div class="tenor-gif-embed"
         data-postid="26312790"
         data-share-method="host"
         data-aspect-ratio="1.2549"
         data-width="100%">
      <a href="https://tenor.com/view/bugcat-capoo-bugcat-capoo-tutu-hug-gif-26312790">Bugcat Capoo Sticker</a>
      from <a href="https://tenor.com/search/bugcat-stickers">Bugcat Stickers</a>
    </div>
  </div>

  <script>
    // ====== WIDOKI: zawsze tylko jeden ======
    function showStep(step){
      const gateWrap = document.getElementById("gateWrap");
      const mazeGate = document.getElementById("mazeGate");
      const card = document.getElementById("card");
      const loveAttack = document.getElementById("loveAttack");

      gateWrap.classList.add("hidden");
      mazeGate.classList.add("hidden");
      card.classList.add("hidden");
      loveAttack.classList.add("hidden");

      if (step === 1) gateWrap.classList.remove("hidden");
      if (step === 2) mazeGate.classList.remove("hidden");
      if (step === 3) card.classList.remove("hidden");
      if (step === 4) loveAttack.classList.remove("hidden");
    }

    function resetCaptchaUI(){
      document.querySelectorAll(".cap-tile.selected").forEach(t => t.classList.remove("selected"));
      document.getElementById("hint").textContent = "";
    }

    // ====== CAPTCHA USTAWIENIA ======
    const images = [
      { src: "img/1.png", correct: true },
      { src: "img/2.png", correct: true },
      { src: "img/3.png", correct: true },
      { src: "img/4.png", correct: true },
      { src: "img/8.png", correct: false },
      { src: "img/6.png", correct: true },
      { src: "img/7.png", correct: true },
      { src: "img/5.png", correct: true },
      { src: "img/9.png", correct: false },
    ];

    const grid = document.getElementById("grid");
    const hint = document.getElementById("hint");

    for (let i = 0; i < 9; i++) {
      const tile = document.createElement("div");
      tile.className = "cap-tile";
      tile.dataset.idx = String(i);

      const img = document.createElement("img");
      img.src = images[i].src;
      img.alt = "Obraz " + (i + 1);
      img.loading = "lazy";
      tile.appendChild(img);

      tile.addEventListener("click", () => tile.classList.toggle("selected"));
      grid.appendChild(tile);
    }

    function getSelectedIdx() {
      return [...document.querySelectorAll(".cap-tile.selected")]
        .map(t => Number(t.dataset.idx))
        .sort((a,b)=>a-b);
    }

    function getCorrectIdx() {
      return images
        .map((it, i) => it.correct ? i : null)
        .filter(v => v !== null)
        .sort((a,b)=>a-b);
    }

    document.getElementById("resetBtn").addEventListener("click", resetCaptchaUI);

    document.getElementById("checkBtn").addEventListener("click", () => {
      const sel = getSelectedIdx();
      const cor = getCorrectIdx();
      const ok = sel.length === cor.length && sel.every((v,i)=>v===cor[i]);

      if (ok) {
        resetCaptchaUI();
        showStep(2); // -> labirynt
        resetMaze("Kliknij Start üôÇ");
      } else {
        hint.textContent = "CO?!!! Wybieraj jeszcze raz!";
      }
    });

    // ====== IMIƒò Z URL ======
    const params = new URLSearchParams(location.search);
    const imie = params.get("imie");
    if (imie) document.getElementById("name").textContent = imie;

    // ====== SERDUSZKA ======
    const hearts = ["üíñ","üíò","üíï","‚ù§Ô∏è","üíó"];
    for (let i=0;i<18;i++){
      const s = document.createElement("div");
      s.className = "heart";
      s.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      s.style.setProperty("--x", (Math.random()*100) + "vw");
      s.style.setProperty("--s", (18+Math.random()*22) + "px");
      s.style.setProperty("--d", (6+Math.random()*8) + "s");
      s.style.animationDelay = (-Math.random()*10) + "s";
      document.body.appendChild(s);
    }

    // ====== TAK -> ATAK MI≈ÅO≈öCI ======
    document.getElementById("yesBtn").onclick = () => {
      showStep(4);
      confetti();
    };

    // ====== NIE UCIEKA ======
    const noBtn = document.getElementById("noBtn");
    noBtn.onmouseover = () => {
      const card = document.getElementById("card").getBoundingClientRect();
      const x = Math.random()*(card.width-90);
      const y = Math.random()*(card.height-50);
      noBtn.style.position = "absolute";
      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    };

    // ====== CONFETTI ======
    function confetti(){
      for(let i=0;i<120;i++){
        const p=document.createElement("div");
        p.style.position="fixed";
        p.style.left=(innerWidth/2)+"px";
        p.style.top=(innerHeight/2)+"px";
        p.style.width="8px"; p.style.height="8px";
        p.style.borderRadius="2px";
        p.style.background=`hsl(${Math.random()*360}, 90%, 60%)`;
        p.style.zIndex=9999;
        const ang=Math.random()*Math.PI*2;
        const vel=4+Math.random()*8;
        let x=0,y=0,vy=0;
        document.body.appendChild(p);
        const t=setInterval(()=>{
          x+=Math.cos(ang)*vel;
          y+=Math.sin(ang)*vel;
          vy+=0.25; y+=vy;
          p.style.transform=`translate(${x}px, ${y}px) rotate(${i*3}deg)`;
        },16);
        setTimeout(()=>{clearInterval(t); p.remove();}, 1200+Math.random()*600);
      }
    }

    // ====== LABIRYNT LOGIKA ======
    const mazeCanvas = document.getElementById("maze");
    const ctx = mazeCanvas.getContext("2d");
    const mazeHint = document.getElementById("mazeHint");
    const startBtn = document.getElementById("mazeStart");
    const resetBtn = document.getElementById("mazeReset");

    let started = false;

    // start i cel
    const startPoint = { x: 26, y: 26 };
    const cursor = { x: startPoint.x, y: startPoint.y };
    const cursorR = 6;

    // u≈ºyj zdjƒôcia numer 1
    const goalImgSrc = "img/1.png";
    const goalImg = new Image();
    goalImg.src = goalImgSrc;

    const goal = { x: 308, y: 308, r: 26 };

    // ≈õciany labiryntu (prostokƒÖty)
    const walls = [
      // ramka
      {x:10,y:10,w:340,h:10},{x:10,y:340,w:340,h:10},{x:10,y:10,w:10,h:340},{x:340,y:10,w:10,h:340},

      // wewnƒôtrzne
      {x:40,y:40,w:280,h:10},
      {x:40,y:40,w:10,h:220},
      {x:70,y:80,w:220,h:10},
      {x:120,y:110,w:10,h:180},
      {x:150,y:140,w:160,h:10},
      {x:190,y:140,w:10,h:140},
      {x:70,y:220,w:160,h:10},
      {x:260,y:80,w:10,h:200},
      {x:70,y:260,w:10,h:70},
      {x:90,y:300,w:220,h:10},
    ];

    function drawMaze(){
      ctx.clearRect(0,0,mazeCanvas.width, mazeCanvas.height);

      // t≈Ço
      ctx.fillStyle = "#fff";
      ctx.fillRect(0,0,mazeCanvas.width, mazeCanvas.height);

      // ≈õciany
      ctx.fillStyle = "#222";
      walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));

      // start
      ctx.fillStyle = "#2f74ff";
      ctx.beginPath();
      ctx.arc(startPoint.x, startPoint.y, 10, 0, Math.PI*2);
      ctx.fill();

      // cel (zdjƒôcie w k√≥≈Çku)
      ctx.save();
      ctx.beginPath();
      ctx.arc(goal.x, goal.y, goal.r, 0, Math.PI*2);
      ctx.clip();
      if (goalImg.complete) {
        ctx.drawImage(goalImg, goal.x-goal.r, goal.y-goal.r, goal.r*2, goal.r*2);
      } else {
        ctx.fillStyle = "#ffd1dc";
        ctx.fill();
      }
      ctx.restore();

      ctx.strokeStyle = "#ff3b6b";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.arc(goal.x, goal.y, goal.r, 0, Math.PI*2);
      ctx.stroke();

      // kursor
      ctx.fillStyle = "#ff3b6b";
      ctx.beginPath();
      ctx.arc(cursor.x, cursor.y, cursorR, 0, Math.PI*2);
      ctx.fill();

      // overlay info
      if (!started) {
        ctx.fillStyle = "rgba(0,0,0,.55)";
        ctx.font = "14px Arial";
        ctx.fillText("Kliknij Start i jed≈∫ do zdjƒôcia", 78, 24);
      }
    }

    function resetMaze(msg){
      started = false;
      cursor.x = startPoint.x;
      cursor.y = startPoint.y;
      mazeHint.textContent = msg || "";
      drawMaze();
    }

    function hitWall(x,y){
      for (const w of walls) {
        const closestX = Math.max(w.x, Math.min(x, w.x+w.w));
        const closestY = Math.max(w.y, Math.min(y, w.y+w.h));
        const dx = x - closestX;
        const dy = y - closestY;
        if (dx*dx + dy*dy <= cursorR*cursorR) return true;
      }
      return false;
    }

    function reachedGoal(x,y){
      const dx = x - goal.x;
      const dy = y - goal.y;
      return (dx*dx + dy*dy) <= (goal.r*goal.r);
    }

    function canvasPosFromEvent(ev){
      const rect = mazeCanvas.getBoundingClientRect();
      const scaleX = mazeCanvas.width / rect.width;
      const scaleY = mazeCanvas.height / rect.height;
      const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
      const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
      return { x:(clientX-rect.left)*scaleX, y:(clientY-rect.top)*scaleY };
    }

    function onMove(ev){
      if (!started) return;

      const {x,y} = canvasPosFromEvent(ev);

      // poza planszƒÖ
      if (x<0 || y<0 || x>mazeCanvas.width || y>mazeCanvas.height) {
        resetMaze("Wr√≥ƒá na start üôÇ");
        return;
      }

      // dotkniƒôcie ≈õciany
      if (hitWall(x,y)) {
        cursor.x = startPoint.x;
        cursor.y = startPoint.y;
        started = false;
        mazeHint.textContent = "Au! DotknƒÖ≈Çe≈õ ≈õciany üòÑ Spr√≥buj jeszcze";
        drawMaze();
        return;
      }

      cursor.x = x; cursor.y = y;

      // sukces -> przej≈õcie do pytania
      if (reachedGoal(x,y)) {
        mazeHint.textContent = "Sukces! üíò";
        started = false;
        drawMaze();
        setTimeout(() => {
          showStep(3);
        }, 350);
        return;
      }

      drawMaze();
    }

    startBtn.addEventListener("click", () => {
      started = true;
      mazeHint.textContent = "Jed≈∫ do zdjƒôcia!";
      cursor.x = startPoint.x;
      cursor.y = startPoint.y;
      drawMaze();
    });

    resetBtn.addEventListener("click", () => resetMaze("Kliknij Start üôÇ"));

    mazeCanvas.addEventListener("mousemove", onMove);
    mazeCanvas.addEventListener("touchmove", (e) => { e.preventDefault(); onMove(e); }, {passive:false});

    goalImg.onload = drawMaze;
    drawMaze();

    // start: tylko 1 widok
    showStep(1);
  </script>

  <script async src="https://tenor.com/embed.js"></script>
</body>
</html>




